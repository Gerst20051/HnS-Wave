<!--
 ::::::::  :::::::::  ::::::::::     ::: ::::::::::: :::::::::: :::::::::       :::::::::  :::   :::
:+:    :+: :+:    :+: :+:          :+: :+:   :+:     :+:        :+:    :+:      :+:    :+: :+:   :+: :+:
+:+        +:+    +:+ +:+         +:+   +:+  +:+     +:+        +:+    +:+      +:+    +:+  +:+ +:+
+#+        +#++:++#:  +#++:++#   +#++:++#++: +#+     +#++:++#   +#+    +:+      +#++:++#+    +#++:
+#+        +#+    +#+ +#+        +#+     +#+ +#+     +#+        +#+    +#+      +#+    +#+    +#+
#+#    #+# #+#    #+# #+#        #+#     #+# #+#     #+#        #+#    #+#      #+#    #+#    #+#    #+#
 ########  ###    ### ########## ###     ### ###     ########## #########       #########     ###



    :::     ::::    ::: :::::::::  :::::::::  :::::::::: :::       :::       ::::::::  :::::::::: :::::::::   :::::::: :::::::::::
  :+: :+:   :+:+:   :+: :+:    :+: :+:    :+: :+:        :+:       :+:      :+:    :+: :+:        :+:    :+: :+:    :+:    :+:
 +:+   +:+  :+:+:+  +:+ +:+    +:+ +:+    +:+ +:+        +:+       +:+      +:+        +:+        +:+    +:+ +:+           +:+
+#++:++#++: +#+ +:+ +#+ +#+    +:+ +#++:++#:  +#++:++#   +#+  +:+  +#+      :#:        +#++:++#   +#++:++#:  +#++:++#++    +#+
+#+     +#+ +#+  +#+#+# +#+    +#+ +#+    +#+ +#+        +#+ +#+#+ +#+      +#+   +#+# +#+        +#+    +#+        +#+    +#+
#+#     #+# #+#   #+#+# #+#    #+# #+#    #+# #+#         #+#+# #+#+#       #+#    #+# #+#        #+#    #+# #+#    #+#    #+#
###     ### ###    #### #########  ###    ### ##########   ###   ###         ########  ########## ###    ###  ########     ###
-->
<!DOCTYPE html><html><head><meta charset="utf-8">
<title>Word Racer (via Canvas Engine)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.14.1/lodash.min.js"></script>
<script>__ = _.noConflict()</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="../canvasengine.js"></script>
<style>
body {
    background-color: rgb(130, 170, 230);
    margin: 0;
    padding: 0;
}

#title {
    color: #fff;
    font-family: Helvetica;
    font-size: 80px;
    height: 200px;
    line-height: 200px;
    position: absolute;
    text-align: center;
    top: 0;
    width: 100%;
}

#canvaspane {
    cursor: default;
}

#progressinfo {
    background-color: rgb(241, 240, 157);
    border: 2px solid #111;
    border-radius: 10px;
    display: none;
    height: 50px;
    line-height: 50px;
    position: absolute;
}

#roundinfo,
#countdown {
    font-family: Helvetica;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    width: 50%;
}

#roundinfo {
    float: left;
}

#countdown {
    float: right;
}

#roundnumber,
#countdowntime {
    color: rgb(79, 113, 29);
}

#searchterm {
    background-color: rgba(255, 255, 255, 0.4);
    border-radius: 1em;
    color: #fff;
    display: none;
    font-family: Helvetica;
    font-size: 50px;
    font-weight: bold;
    height: 100px;
    letter-spacing: 20px;
    line-height: 100px;
    position: absolute;
    text-align: center;
}

#searchterm.foundword {
    border: 2px solid #ffd700;
}

#alertpanel {
    color: #f00;
    display: none;
    font-family: Helvetica;
    font-size: 18px;
    font-weight: bold;
    height: 50px;
    letter-spacing: 12px;
    line-height: 50px;
    position: absolute;
    text-align: center;
}

#scorepaneltitle,
#wordpaneltitle {
    color: #000;
    display: none;
    font-family: Helvetica;
    font-weight: bold;
    height: 40px;
    line-height: 40px;
    position: absolute;
    text-align: center;
    width: 250px;
}

#wordpanel,
#scorepanel {
    background-color: rgba(255, 255, 255, 0.15);
    border-radius: 20px;
    color: #fff;
    display: none;
    font-family: Helvetica;
    font-weight: bold;
    letter-spacing: 6px;
    overflow: scroll;
    padding: 20px;
    position: absolute;
    width: 210px;
}

#wordpanel .wordpanelrow > div,
#scorepanel .scorepanelrow > div {
    width: 50%;
}

#wordpanel .wordpanelrowtext,
#scorepanel .scorepanelrowtext {
    float: left;
}

#wordpanel .wordpanelrowpoints,
#scorepanel .scorepanelrowpoints {
    float: right;
    text-align: right;
}

hr#wordpaneldivider {
    border: none;
    border-top: medium double #fff;
    clear: both;
    color: #fff;
    margin-top: 70px;
    padding: 0;
    text-align: center;
}

hr#wordpaneldivider:after {
    content: 'ยง';
    display: inline-block;
    font-size: 1.5em;
    padding: 0 0.25em;
    position: relative;
    top: -0.7em;
}
</style>
</head>
<body>
<div id="content">
    <div id="title">Word Racer</div>
    <div id="canvaspane">
        <canvas id="canvas1" height="100" width="100"></canvas>
    </div>
    <div id="progressinfo">
        <div id="roundinfo">Round: <span id="roundnumber"></span></div>
        <div id="countdown">Time: <span id="countdowntime"></span></div>
    </div>
    <div id="searchterm"></div>
    <div id="alertpanel"></div>
    <div id="scorepaneltitle">Points</div>
    <div id="scorepanel"></div>
    <div id="wordpaneltitle">Words Found <span id="wordsfoundcount"></span></div>
    <div id="wordpanel"></div>
</div>
<script>
var dictionary, frequencies, grids;
var trie = {};
var eow = '_';
var gridSolutions = [];
var playGrids = {};
var pathTree = [];

loadJSONFiles();

function loadJSONFiles() {
    var jsonPath = 'https://raw.githubusercontent.com/Gerst20051/HnS-Wave/wordracer/src/games/word-racer/';
    var getDictionaries = $.getJSON(jsonPath + 'dictionary.json');
    var getFrequencies = $.getJSON(jsonPath + 'frequencies.json');
    var getGrids = $.getJSON(jsonPath + 'round-grids.json');
    $.when(getDictionaries, getFrequencies, getGrids).done(function (dictionaryJSON, frequenciesJSON, gridJSON) {
        dictionary = dictionaryJSON[0];
        frequencies = frequenciesJSON[0];
        grids = gridJSON[0];
        gridSolutions = Array(6).fill([]);
        pathTree = Array(6).fill({});
        wordsFound = Array(6).fill([]);
        init();
    });
}

function log(key, value) {
  console.log(key, JSON.stringify(value));
}

function init() {
  createTrie();
  generateGrid();
  generateGridSolutions();
  generateScene();
  startCountdownToBeginningOfRound();
}

function createTrie() {
  _.each(dictionary, word => {
    __.set(trie, `${word}${eow}`.split(''), true);
  });
}

function searchTrie(word) {
  return __.get(trie, `${word.toUpperCase()}${eow}`.split(''), false);
}

function existsInTrie(word) {
  return __.has(trie, word.toUpperCase().split('').join('.'));
}

function generateLetterDistribution() {
  const minFrequency = __.min(_.values(frequencies));
  const multiplier = __.round(102 / minFrequency);
  const letterCounts = __.mapValues(frequencies, (freq, letter) => { return __.round(freq * multiplier); });
  return _.reduce(letterCounts, (string, count, letter) => { return string += __.repeat(letter, count); }, '');
}

function generateGrid() {
  const letters = generateLetterDistribution();
  playGrids = _.map(grids, grid => {
    const count = _.reduce(_.flatten(grid), (carry, item) => { return item ? ++carry : carry; }, 0);
    const chars = _.map(_.times(count, () => _.sample(letters)), c => { return c === '0' ? 'Qu' : c });
    return _.map(grid, row => {
      return _.map(row, item => {
        return item ? chars.shift() : undefined;
      });
    });
  });
}

function generateGridSolutions() {
  _.each(playGrids, (grid, gridIndex) => {
    _.each(grid, (row, rowIndex) => {
      _.each(row, (item, itemIndex) => {
        if (item) {
          const pathTreeKey = `${rowIndex},${itemIndex}`;
          pathTree[gridIndex][pathTreeKey] = {};
          spiderGridFromIndex(gridIndex, rowIndex, itemIndex, pathTreeKey, []);
        }
      });
    });
  });
}

function getNearGridOptions(grid, rowIndex, itemIndex) {
    const w = grid[rowIndex] && grid[rowIndex][itemIndex - 1] && [rowIndex, itemIndex - 1];
    const nw = grid[rowIndex - 1] && grid[rowIndex - 1][itemIndex - 1] && [rowIndex - 1 , itemIndex - 1];
    const n = grid[rowIndex - 1] && grid[rowIndex - 1][itemIndex] && [rowIndex - 1 , itemIndex];
    const ne = grid[rowIndex - 1] && grid[rowIndex - 1][itemIndex + 1] && [rowIndex - 1 , itemIndex + 1];
    const e = grid[rowIndex] && grid[rowIndex][itemIndex + 1] && [rowIndex , itemIndex + 1];
    const se = grid[rowIndex + 1] && grid[rowIndex + 1][itemIndex + 1] && [rowIndex + 1 , itemIndex + 1];
    const s = grid[rowIndex + 1] && grid[rowIndex + 1][itemIndex] && [rowIndex + 1 , itemIndex];
    const sw = grid[rowIndex + 1] && grid[rowIndex + 1][itemIndex - 1] && [rowIndex + 1 , itemIndex - 1];
    return [w, nw, n, ne, e, se, s, sw];
}

function setToValue(obj, value, path) {
  for (var i = 0; i < path.length - 1; i++) {
    obj = obj[path[i]];
  }
  obj[path[i]] = value;
}

function getWordFromPath(gridIndex, startingPathKey, path) {
  var word = '';
  for (var i = 0; i < path.length; i++) {
    const coords = path[i].split(',');
    word += playGrids[gridIndex][coords[0]][coords[1]];
  }
  return word;
}

function filterNearGridOptions(gridIndex, gridOptions, path) {
  return _.filter(gridOptions, gridOption => {
    return gridOption && !_.contains(path, `${gridOption[0]},${gridOption[1]}`);
  });
}

function spiderGridFromIndex(gridIndex, rowIndex, itemIndex, startingPathKey, fullPath) {
  const grid = playGrids[gridIndex];
  const nearGridOptionsFiltered = filterNearGridOptions(gridIndex, getNearGridOptions(grid, rowIndex, itemIndex), fullPath);
  _.each(nearGridOptionsFiltered, (gridOption, gridOptionIndex) => {
    const pathTreeKey = `${gridOption[0]},${gridOption[1]}`;
    const currentFullPath = fullPath.concat([ pathTreeKey ]);
    const currentWord = getWordFromPath(gridIndex, startingPathKey, currentFullPath).toUpperCase();
    if (searchTrie(currentWord) && !_.contains(gridSolutions[gridIndex], currentWord)) {
      gridSolutions[gridIndex].push(currentWord);
    }
    if (existsInTrie(currentWord)) {
      spiderGridFromIndex(gridIndex, gridOption[0], gridOption[1], startingPathKey, currentFullPath);
    }
  });
}

var Node,
    Scene,
    mainScene,
    currentSearchTerm = '',
    currentGridIndex = 0,
    countdownToBeginningOfRoundTimeoutId = 0,
    countdownToEndOfRoundTimeoutId = 0,
    gameAlertTimeoutId = 0,
    foundWordTimeoutId = 0,
    gridNodes = [],
    wordsFound = [],
    gridLoading = true,
    gameStarted = false,
    gameOver = false,
    roundStartTime = 0,
    roundIntermissionStartTime = 0,
    roundTimeLimitInSeconds = 80,
    roundIntermissionInSeconds = 12,
    playerScore = 0,
    doFullScreen = false,
    centeredCanvas = true,
    canvasDimension = 800,
    canvasSize = {
        height: (doFullScreen) ? maxHeight : canvasDimension,
        width: (doFullScreen) ? maxWidth : canvasDimension
    };

function startCountdownToBeginningOfRound() {
    roundIntermissionStartTime = timeSeconds();
    roundStartTime = 0;
    gridLoading = true;
    if (gameStarted) {
        addSolutionsToWordPanel();
    }
    countdownToBeginningOfRoundTimeoutId = setTimeout(function () {
        roundIntermissionStartTime = 0;
        roundStartTime = timeSeconds();
        gridLoading = false;
        if (gameStarted) {
            currentGridIndex++;
        } else {
            gameStarted = true;
        }
        startCountdownToEndOfRound();
        generateScene();
        addWordsFoundToPanel();
        countdownToBeginningOfRoundTimeoutId = 0;
    }, 1E3 * roundIntermissionInSeconds);
}

function startCountdownToEndOfRound() {
    countdownToEndOfRoundTimeoutId = setTimeout(function () {
        if (currentGridIndex === gridSolutions.length - 1) {
            roundStartTime = 0;
            gameOver = true;
        } else {
            startCountdownToBeginningOfRound();
        }
        currentSearchTerm = '';
        $('#searchterm').text(currentSearchTerm);
        countdownToEndOfRoundTimeoutId = 0;
    }, 1E3 * roundTimeLimitInSeconds);
}

function generateScene() {
    mainScene = new Scene();
    mainScene.init();
}

Node = function (x, y, letter, rowIndex, itemIndex) {
    x = x;
    y = y;
    letter = letter;
    rowIndex = rowIndex;
    itemIndex = itemIndex;
    selected = false;
    highlighted = false;

    this.draw = function () {
        var nodeType = grids[currentGridIndex][rowIndex][itemIndex];
        fill(gridLoading || gameOver ? (gameStarted ? colors.gray : colors.black) : [ colors.ghostwhite, colors.carolinablue, colors.lightpink ][nodeType - 1]);
        stroke(gridLoading || gameOver || __.includes(currentSearchTerm, letter) ? colors.black : colors.white);
        strokeWeight(2);
        circle(x, y, this.radius);
        textSize(currentGridIndex ? 30 : 46);
        fill(colors.black);
        var radiusXOffset = (letter === 'I') ? this.radius / 10 : (letter === 'Qu') ? this.radius / 1.7 : this.radius / 3;
        text(letter, x - radiusXOffset, y + this.radius / 2.7);
    };

    this.setX = function (newX) { x = newX; };
    this.getX = function () { return x; };
    this.setY = function (newY) { y = newY; };
    this.getY = function () { return y; };
    this.getLetter = function () { return letter; };
    this.getRowIndex = function () { return rowIndex; };
    this.getItemIndex = function () { return itemIndex; };
    this.isSelected = function () { return selected; };
    this.setSelected = function (isSelected) { selected = isSelected; };
    this.isHighlighted = function () { return highlighted; };
    this.setHighlighted = function (isHighlighted) { highlighted = isHighlighted; };
};

Scene = function () {
    var gridSize = 0;
    var nodeDiameter = 0;
    var nodeRadius = 0;

    this.init = function () {
        this.calculateNodeRadius();
        this.generateNodes();
    };

    this.draw = function () {
        background(color(130, 170, 230));
        if (true) {
            $('#roundnumber').text(currentGridIndex + 1);
            var countdownTimeString = '';
            if (!gameOver) {
                var secondsRemaining = 0;
                if (gridLoading) {
                    secondsRemaining = __.round((roundIntermissionStartTime + roundIntermissionInSeconds) - timeSeconds());
                } else {
                    secondsRemaining = __.round((roundStartTime + roundTimeLimitInSeconds) - timeSeconds());
                }
                countdownTimeString = new Date(secondsRemaining * 1E3).toISOString().substr(15, 4);
            } else {
                countdownTimeString = 'Game Over';
            }
            $('#countdowntime').text(countdownTimeString);
        }
    };

    this.calculateNodeRadius = function () {
        gridSize = canvasDimension / _.first(playGrids[currentGridIndex]).length;
        nodeDiameter = gridSize / 2;
        nodeRadius = nodeDiameter / 2;
        Node.prototype.radius = nodeRadius;
    };

    this.getNodeCoordinates = function (rowIndex, itemIndex) {
        var nodeXPos = (gridSize * itemIndex) + nodeDiameter;
        var nodeYPos = (gridSize * rowIndex) + nodeDiameter;
        return [nodeXPos, nodeYPos];
    };

    this.generateNodes = function () {
        gridNodes = [];
        var grid = playGrids[currentGridIndex], _this = this;
        _.each(grid, function (row, rowIndex) {
            _.each(row, function (item, itemIndex) {
                if (item) {
                    var coordinates = _this.getNodeCoordinates(rowIndex, itemIndex);
                    gridNodes.push(new Node(coordinates[0], coordinates[1], item, rowIndex, itemIndex));
                }
            });
        });
    };
};

var setup = function () {
    if (doFullScreen) {
        fullScreen();
    } else {
        size(canvasSize.width, canvasSize.height);
    }
    positionElements();
};

var draw = function () {
    mainScene && mainScene.draw();
    drawNodeConnectors();
    drawNodes();
};

function drawNodeConnectors() {
    _.each(gridNodes, function (node) {
        var neighborNodes = [];
    });
}

function drawNodes() {
    _.each(gridNodes, function (node) {
        node.draw();
    });
}

function addWordsFoundToPanel() {
    var wordPointsDistribution = [ 10, 20, 40, 80, 120, 140, 220, 300 ];
    $('#wordpanel').html(_.map(wordsFound[currentGridIndex], function (word) {
        var wordPoints = wordPointsDistribution[word.length - 3] || 400;
        return $('<div/>', { 'class': 'wordpanelrow' })
            .append($('<div/>', { 'class': 'wordpanelrowtext' }).text(word))
            .append($('<div/>', { 'class': 'wordpanelrowpoints' }).text(wordPoints));
    }));
    var wordsFoundCount = wordsFound[currentGridIndex].length;
    $('#wordsfoundcount').text('(' + wordsFound[currentGridIndex].length + ') ' + __.round((wordsFoundCount / _.filter(gridSolutions[currentGridIndex], function (s) { return s.length > 2; }).length) * 100) + '%');
    playerScore = _.reduce(wordsFound, function (carry, wordsFoundGrid) {
        return carry += _.reduce(wordsFoundGrid, function (carry, word) {
            return carry += wordPointsDistribution[word.length - 3] || 400;
        }, 0);
    }, 0);
    $('#scorepanel').html(
        $('<div/>', { 'class': 'scorepanelrow' })
            .append($('<div/>', { 'class': 'scorepanelrowtext' }).text('You'))
            .append($('<div/>', { 'class': 'scorepanelrowpoints' }).text(playerScore))
    );
}

function addSolutionsToWordPanel() {
    var wordPointsDistribution = [ 10, 20, 40, 80, 120, 140, 220, 300 ];
    var solutions = _.filter(gridSolutions[currentGridIndex], function (s) {
        return s.length > 2 && !_.contains(wordsFound[currentGridIndex], s);
    }).sort(); // could also sort by word length
    if (!solutions.length) {
        return;
    }
    if (wordsFound[currentGridIndex].length) {
        $('#wordpanel').append($('<hr/>', { 'id': 'wordpaneldivider' }));
    }
    $('#wordpanel').append(_.map(solutions, function (word) {
        var wordPoints = wordPointsDistribution[word.length - 3] || 400;
        return $('<div/>', { 'class': 'wordpanelrow' })
            .append($('<div/>', { 'class': 'wordpanelrowtext' }).text(word))
            .append($('<div/>', { 'class': 'wordpanelrowpoints' }).text(wordPoints));
    }));
}

function showGameToastAlert(text) {
    $('#alertpanel').finish().text(text).fadeIn();
    clearTimeout(gameAlertTimeoutId);
    gameAlertTimeoutId = setTimeout(function() {
        $('#alertpanel').finish().fadeOut(400, function () {
            $(this).empty();
        });
    }, 2E3);
}

function doFoundWordEffect() {
    $('#alertpanel').finish().empty();
    $('#searchterm').addClass('foundword');
    clearTimeout(foundWordTimeoutId);
    foundWordTimeoutId = setTimeout(function() {
        $('#searchterm').removeClass('foundword');
    }, 500);
}

keyUp = function (e) {
    if (gridLoading || gameOver) {
        return;
    }
    if (keycode.getKeyCode(e) === keys.BACKSPACE) {
        currentSearchTerm = currentSearchTerm.slice(0, -1);
    } else if (_.contains([ keys.ENTER, keys.RETURN ], keycode.getKeyCode(e))) {
        if (!currentSearchTerm.length) {
            return;
        }
        if (currentSearchTerm.length > 2 && _.contains(gridSolutions[currentGridIndex], currentSearchTerm)) {
            if (!_.contains(wordsFound[currentGridIndex], currentSearchTerm)) {
                wordsFound[currentGridIndex].unshift(currentSearchTerm);
                doFoundWordEffect();
            } else {
                showGameToastAlert('The Word \'' + currentSearchTerm + '\' Has Already Been Found!');
            }
        } else if (currentSearchTerm.length < 3) {
            showGameToastAlert('Words Must Be 3 Characters Or Longer!');
        } else if (searchTrie(currentSearchTerm)) {
            showGameToastAlert('\'' + currentSearchTerm + '\' Is Not In The Grid!');
        } else {
            showGameToastAlert('\'' + currentSearchTerm + '\' Is Not A Word!');
        }
        currentSearchTerm = '';
        addWordsFoundToPanel();
    } else {
        var letter = (keycode.getValueByEvent(e) || '').toUpperCase().replace(/[^a-zA-Z]/g, '');
        letter = letter.length === 1 ? letter : '';
        currentSearchTerm += letter;
    }
    $('#searchterm').text(currentSearchTerm);
};

windowResized = function () {
    positionElements();
};


function positionElements() {
    centerCanvas();
    positionProgressInfo()
    positionSearchTerm();
    positionAlertPanel();
    positionWordPanel();
    positionScorePanel();
}

function centerCanvas() {
    $canvas = $('#canvas1'), $window = $(window);
    $canvas.css({
        'left': (($window.width() - canvasSize.width) / 2) + 'px',
        'position': 'absolute',
        'top': (($window.height() - canvasSize.height) / 2) + 'px'
    });
}

function positionProgressInfo() {
    $div = $('#progressinfo'), $canvas = $('#canvas1'), padding = 20;
    $div.css({
        'top': (parseInt($canvas.css('top')) + canvasSize.height + padding) + 'px',
        'left': parseInt($canvas.css('left')) + 'px',
        'width': canvasSize.width + 'px'
    }).show();
}

function positionSearchTerm() {
    $div = $('#searchterm'), $progressinfo = $('#progressinfo'), padding = 40;
    $div.css({
        'left': parseInt($progressinfo.css('left')) + 'px',
        'top': (parseInt($progressinfo.css('top')) + parseInt($progressinfo.css('height')) + padding) + 'px',
        'width': canvasSize.width + 'px'
    }).show();
}

function positionAlertPanel() {
    $div = $('#alertpanel'), $searchterm = $('#searchterm'), panelWidth = 250, padding = 20;
    $div.css({
        'left': (parseInt($searchterm.css('left')) - panelWidth) + 'px',
        'top': (parseInt($searchterm.css('top')) + parseInt($searchterm.css('height')) + padding) + 'px',
        'width': (canvasSize.width + 2 * panelWidth) + 'px'
    }).show();
}

function positionWordPanel() {
    $div = $('#wordpanel'), $title = $('#wordpaneltitle'), $canvas = $('#canvas1'), titleHeight = 40, padding = 20;
    $div.css({
        'height': (canvasSize.height - (2 * parseInt($div.css('padding')))) + 'px',
        'left': (parseInt($canvas.css('left')) + canvasSize.width + padding) + 'px',
        'top': parseInt($canvas.css('top')) + 'px'
    }).show();
    $title.css({
        'left': parseInt($div.css('left')) + 'px',
        'top': (parseInt($div.css('top')) - titleHeight) + 'px'
    }).show();
}

function positionScorePanel() {
    $div = $('#scorepanel'), $title = $('#scorepaneltitle'), $canvas = $('#canvas1'), panelWidth = 250, titleHeight = 40, padding = 20;
    $div.css({
        'height': (canvasSize.height - (2 * parseInt($div.css('padding')))) + 'px',
        'left': (parseInt($canvas.css('left')) - panelWidth - (2 * padding)) + 'px',
        'top': parseInt($canvas.css('top')) + 'px'
    }).show();
    $title.css({
        'left': parseInt($div.css('left')) + 'px',
        'top': (parseInt($div.css('top')) - titleHeight) + 'px'
    }).show();
}

window.onload = function () {
    window.canvas = new Canvas(document.getElementById('canvas1'));
    window.ctx = canvas.ctx;
    canvas.setup = window.setup;
    canvas.draw = window.draw;
    canvas.run();
};

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42786295-1', 'hnswave.co');
ga('send', 'pageview');
</script>
</body>
</html>
