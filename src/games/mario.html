<!--
 ::::::::  :::::::::  ::::::::::     ::: ::::::::::: :::::::::: :::::::::       :::::::::  :::   :::                               
:+:    :+: :+:    :+: :+:          :+: :+:   :+:     :+:        :+:    :+:      :+:    :+: :+:   :+: :+:                           
+:+        +:+    +:+ +:+         +:+   +:+  +:+     +:+        +:+    +:+      +:+    +:+  +:+ +:+                                
+#+        +#++:++#:  +#++:++#   +#++:++#++: +#+     +#++:++#   +#+    +:+      +#++:++#+    +#++:                                 
+#+        +#+    +#+ +#+        +#+     +#+ +#+     +#+        +#+    +#+      +#+    +#+    +#+                                  
#+#    #+# #+#    #+# #+#        #+#     #+# #+#     #+#        #+#    #+#      #+#    #+#    #+#    #+#                           
 ########  ###    ### ########## ###     ### ###     ########## #########       #########     ###                                  
                                                                                                                                   
                                                                                                                                   
                                                                                                                                   
    :::     ::::    ::: :::::::::  :::::::::  :::::::::: :::       :::       ::::::::  :::::::::: :::::::::   :::::::: ::::::::::: 
  :+: :+:   :+:+:   :+: :+:    :+: :+:    :+: :+:        :+:       :+:      :+:    :+: :+:        :+:    :+: :+:    :+:    :+:     
 +:+   +:+  :+:+:+  +:+ +:+    +:+ +:+    +:+ +:+        +:+       +:+      +:+        +:+        +:+    +:+ +:+           +:+     
+#++:++#++: +#+ +:+ +#+ +#+    +:+ +#++:++#:  +#++:++#   +#+  +:+  +#+      :#:        +#++:++#   +#++:++#:  +#++:++#++    +#+     
+#+     +#+ +#+  +#+#+# +#+    +#+ +#+    +#+ +#+        +#+ +#+#+ +#+      +#+   +#+# +#+        +#+    +#+        +#+    +#+     
#+#     #+# #+#   #+#+# #+#    #+# #+#    #+# #+#         #+#+# #+#+#       #+#    #+# #+#        #+#    #+# #+#    #+#    #+#     
###     ### ###    #### #########  ###    ### ##########   ###   ###         ########  ########## ###    ###  ########     ###     
-->
<!DOCTYPE html><html><head><meta charset="utf-8">
<title>Mario (via Canvas Engine)</title>
<script src="canvasengine.js"></script>
<style>
body {
	margin: 0;
	overflow: hidden;
	padding: 0;
}

#canvaspane {
	cursor: default;
}
</style>
</head>
<body>
<div id="content">
<div id="canvaspane">
<canvas id="canvas1" width="100" height="100"></canvas>
</div>
</div>
<script>
// TODO: Create GameObject Class That Can Be Extended

var gameObjects = [],
	doFullScreen = true,
	gameSize = {
		height: (doFullScreen) ? maxHeight : 400,
		width: (doFullScreen) ? maxWidth : 400
	},
	isPaused = false,
	numEnemies = 0,
	player;

function GameObject(){
	this.x = 0;
	this.y = 0;
	this.destroy = false;
	this.active = true;
	this.collidable = true;
	this.isColliding = false;
	this.collidableWith = "";
	this.type == "";

	this.activate = function(){
		this.active = true;
	};

	this.deactivate = function(){
		this.active = false;
	};

	this.kill = function(){
		this.destroy = true;
	};

	this.isCollidableWith = function(obj){
		return (this.collidableWith === obj.type);
	};

	this.run = nop;
	this.draw = nop;
}

var Enemy = function(x, y){
	this.size = 25;
	this.x = x || gameSize.width * Math.random();
	this.y = y || gameSize.height * 0.85;
	this.dir = (this.x < player.x) ? 1 : -1;
	this.speed = 1;
	this.health = 1;
	this.destroy = false;
	this.active = true;

	this.run = function(){

	};

	this.move = function(){
		this.x += this.speed * this.dir;
	};

	this.draw = function(){
		var offset = 50;
		this.move();
		fill(colors.black);
		noStroke();
		triangle(
			this.x,
			this.y,
			this.x,
			this.y - (this.size * 2),
			this.x + (this.size * this.dir),
			this.y - this.size
		);
	};
};

Enemy.prototype = new GameObject();

var Bullet = function(x, y, dir){
	this.size = 10;
	this.x = x;
	this.y = y;
	this.dir = dir;
	this.speed = 1;
	this.destroy = false;
	this.active = true;

	this.run = function(){
		//this.move();
	};

	this.move = function(){
		this.x += this.speed * this.dir;
	};

	this.draw = function(){
		var xoffset = (0 < this.dir) ? 0 : (this.size * 2) * this.dir;
		this.move();
		fill();
		stroke();
		rect(
			this.x + (player.size * this.dir) + xoffset,
			this.y - player.size - (this.size / 2),
			this.size * 2,
			this.size
		);
		//circle(this.x - player.size, this.y, 30);
	};
};

Bullet.prototype = new GameObject();

var Player = function(x, y){
	this.size = 50;
	this.x = x || gameSize.width / 2;
	this.y = y || gameSize.height * 0.85;
	this.dx = 0;
	this.dy = 0;
	this.dir = 1;
	this.wobbledir = 1;
	this.speed = 1;
	this.health = 1;
	this.energy = 1;
	this.points = 0;
	this.bullets = [];
	this.destroy = false;
	this.active = true;

	this.run = function(){

	};

	this.wobble = function(){
		if (this.dy === 7 || this.dy === -7) {
			this.wobbledir = -this.wobbledir;
		}
		this.y += this.wobbledir * 0.5;
		this.dy += this.wobbledir * 0.5;
	};

	this.goLeft = function(){
		this.dir = -1;
	};

	this.goRight = function(){
		this.dir = 1;
	};

	this.move = function(){
		this.x += this.speed * this.dir;
	};

	this.shoot = function(){
		// TODO: Reuse Bullet Objects
		this.bullets.push(new Bullet(this.x, this.y, this.dir));
		// find closest enemy
		// decrease enemy health
	};

	this.jump = function(){
		this.y -= 30;
		this.dy -= 30;
	};

	this.draw = function(){
		//var offset
		noStroke();
		fill(colors.white);
		triangle(
			this.x, this.y,
			this.x, this.y - this.size * 2,
			this.x + this.size * this.dir, this.y - this.size
		);
		this.bullets.forEach(function(obj){
			obj.draw && obj.draw();
			obj.active && obj.run && obj.run();
		});
	};
};

Player.prototype = new GameObject();

var Cloud = function(x, y){
	this.size = 100;
	this.x = x || 170;
	this.y = y || 80;
	this.fill = '#8ed6ff';
	this.destroy = false;
	this.active = true;

	this.draw = function(){
		fill(this.fill);
		stroke(colors.carolinablue);
		strokeWeight(5);
		engage();
		begin(this.x, this.y);
		bezierCurve(130, 100, 130, 150, 230, 150);
		bezierCurve(250, 180, 320, 180, 340, 150);
		bezierCurve(420, 150, 420, 120, 390, 100);
		bezierCurve(430, 40, 370, 30, 340, 50);
		bezierCurve(320, 5, 250, 20, 250, 50);
		bezierCurve(200, 5, 150, 20, 170, 80);
		paint();
	};
};

Cloud.prototype = new GameObject();

var GameBackground = function(){
	this.draw = function(){
		ctx.globalAlpha = 0.4;
		var linGrad = ctx.createLinearGradient(0, 0, 0, gameSize.height);
		linGrad.addColorStop(0, colors.brightskyblue);
		linGrad.addColorStop(0.85, colors.skyblue);
		linGrad.addColorStop(0.85, colors.greengrass);
		linGrad.addColorStop(1, colors.darkgreen);
		fill(linGrad);
		noStroke();
		rect(0, 0, gameSize.width, gameSize.height);
	};
};

GameBackground.prototype = new GameObject();

var PausedScreen = function(){
	this.draw = function(){
		if (isPaused) {
			fill(colors.black);
			noStroke();
			rect(0, 0, gameSize.width, gameSize.height);
		}
	};
};

PausedScreen.prototype = new GameObject();

var setup = function(){
	if (doFullScreen) {
		fullScreen();
	} else {
		size(gameSize.width, gameSize.height);
	}

	player = new Player();
	gameObjects.push(new GameBackground());
	gameObjects.push(new PausedScreen());
	gameObjects.push(new Cloud());
	gameObjects.push(player);
};

var draw = function(){
	checkGameObjects();
	manageEnemies();

	gameObjects.forEach(function(obj){
		obj.active && obj.run && obj.run();
		obj.draw && obj.draw();
	});
};

var keyDown = function(){
	if (keyCode === keys.SPACE) {
		player.shoot();
	} else if (keyCode === keys.LEFT) {
		player.goLeft();
	} else if (keyCode === keys.RIGHT) {
		player.goRight();
	} else if (keyCode === keys.UP) {
		player.jump();
	}
};

var keyPressed = function(){
	if (keyCode === keys.P) {
		playPause();
	}
};

function playPause(){
	if (isPaused) {
		gameObjects.forEach(function(obj){
			obj.activate && obj.activate();
		});
	} else {
		gameObjects.forEach(function(obj){
			obj.deactivate && obj.deactivate();
		});
	}

	isPaused = !isPaused;
}

function containsPoint(obj1, obj2){
	if (obj1.x < obj2.x + obj2.width &&
		obj1.x + obj1.width  > obj2.x &&
		obj1.y < obj2.y + obj2.height &&
		obj1.y + obj1.height > obj2.y) {
		return true;
	}
	if (obj1.x >= obj2.x &&
		obj1.y >= obj2.y &&
		obj1.x <= obj2.x + obj2.width &&
		obj1.y <= obj2.y + obj2.height) {
		return true;
	}
	return false;
}

function manageEnemies(){
	if (numEnemies < 5) {
		gameObjects.push(new Enemy());
		numEnemies++;
	}
}

function checkGameObjects(){
	var badObjects = [];
	gameObjects.forEach(function(obj){
		if (obj.destroy) {
			badObjects.push(obj);
		}
	});
	badObjects.forEach(function(obj){
		gameObjects.splice(gameObjects.indexOf(obj), 1);
	});
}

window.onload = function(){
	window.canvas = new Canvas(document.getElementById("canvas1"));
	window.ctx = canvas.ctx;
	canvas.setup = window.setup;
	canvas.draw = window.draw;
	canvas.run();
};

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42786295-1', 'hnswave.co');
ga('send', 'pageview');
</script>
</body>
</html>
