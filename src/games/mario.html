<!--
 ::::::::  :::::::::  ::::::::::     ::: ::::::::::: :::::::::: :::::::::       :::::::::  :::   :::                               
:+:    :+: :+:    :+: :+:          :+: :+:   :+:     :+:        :+:    :+:      :+:    :+: :+:   :+: :+:                           
+:+        +:+    +:+ +:+         +:+   +:+  +:+     +:+        +:+    +:+      +:+    +:+  +:+ +:+                                
+#+        +#++:++#:  +#++:++#   +#++:++#++: +#+     +#++:++#   +#+    +:+      +#++:++#+    +#++:                                 
+#+        +#+    +#+ +#+        +#+     +#+ +#+     +#+        +#+    +#+      +#+    +#+    +#+                                  
#+#    #+# #+#    #+# #+#        #+#     #+# #+#     #+#        #+#    #+#      #+#    #+#    #+#    #+#                           
 ########  ###    ### ########## ###     ### ###     ########## #########       #########     ###                                  
                                                                                                                                   
                                                                                                                                   
                                                                                                                                   
    :::     ::::    ::: :::::::::  :::::::::  :::::::::: :::       :::       ::::::::  :::::::::: :::::::::   :::::::: ::::::::::: 
  :+: :+:   :+:+:   :+: :+:    :+: :+:    :+: :+:        :+:       :+:      :+:    :+: :+:        :+:    :+: :+:    :+:    :+:     
 +:+   +:+  :+:+:+  +:+ +:+    +:+ +:+    +:+ +:+        +:+       +:+      +:+        +:+        +:+    +:+ +:+           +:+     
+#++:++#++: +#+ +:+ +#+ +#+    +:+ +#++:++#:  +#++:++#   +#+  +:+  +#+      :#:        +#++:++#   +#++:++#:  +#++:++#++    +#+     
+#+     +#+ +#+  +#+#+# +#+    +#+ +#+    +#+ +#+        +#+ +#+#+ +#+      +#+   +#+# +#+        +#+    +#+        +#+    +#+     
#+#     #+# #+#   #+#+# #+#    #+# #+#    #+# #+#         #+#+# #+#+#       #+#    #+# #+#        #+#    #+# #+#    #+#    #+#     
###     ### ###    #### #########  ###    ### ##########   ###   ###         ########  ########## ###    ###  ########     ###     
-->
<!DOCTYPE html><html><head><meta charset="utf-8">
<title>Mario (via Canvas Engine)</title>
<script src="canvasengine.js"></script>
<style>
body {
	margin: 0;
	overflow: hidden;
	padding: 0;
}

#canvaspane {
	cursor: default;
}
</style>
</head>
<body>
<div id="content">
<div id="canvaspane">
<canvas id="canvas1" width="100" height="100"></canvas>
</div>
</div>
<script>
// TODO: Create GameObject Class That Can Be Extended

var gameObjects = [],
	doFullScreen = true,
	gameSize = {
		height: (doFullScreen) ? maxHeight : 400,
		width: (doFullScreen) ? maxWidth : 400
	},
	isPaused = false,
	bg, cloud, player, enemy;

var Enemy = function(){
	this.x = 0;
	this.y = 0;
	this.dir = 1;
	this.speed = 1;
	this.health = 1;
	this.destroy = false;
	this.active = true;

	this.activate = function(){
		this.active = true;
	};

	this.deactivate = function(){
		this.active = false;
	};

	this.destroy = function(){
		this.destroy = true;
	};

	this.run = function(){

	};

	this.move = function(){
		this.x += this.speed * this.dir;
	};

	this.draw = function(){
		strokeWeight(20);
		point(this.x, this.y);
	};
};

var Bullet = function(x, y, dir){
	this.x = x;
	this.y = y;
	this.dir = dir;
	this.speed = 1;
	this.destroy = false;
	this.active = true;

	this.activate = function(){
		this.active = true;
	};

	this.deactivate = function(){
		this.active = false;
	};

	this.destroy = function(){
		this.destroy = true;
	};

	this.run = function(){
		this.move();
	};

	this.move = function(){
		this.x += this.speed * this.dir;
	};

	this.draw = function(){
		this.move();
	};
};

var Player = function(x, y){
	this.x = x;
	this.y = y;
	this.dx = 0;
	this.dy = 0;
	this.dir = 1;
	this.wobbledir = 1;
	this.speed = 1;
	this.health = 1;
	this.energy = 1;
	this.points = 0;
	this.bullets = [];
	this.destroy = false;
	this.active = true;

	this.activate = function(){
		this.active = true;
	};

	this.deactivate = function(){
		this.active = false;
	};

	this.destroy = function(){
		this.destroy = true;
	};

	this.run = function(){
		this.wobble();
	};

	this.wobble = function(){
		if (this.dy === 7 || this.dy === -7) {
			this.wobbledir = -this.wobbledir;
		}
		this.y += this.wobbledir * 0.5;
		this.dy += this.wobbledir * 0.5;
	};

	this.move = function(){
		this.x += this.speed * this.dir;
	};

	this.attack = function(){
		this.bullets.push(new Bullet(this.x, this.y, this.dir));
		// fire bullets or expand
		// find closest enemy
		// decrease enemy health
	};

	this.draw = function(){
		strokeWeight(10);
		circle(this.x, this.y, 50);
		this.bullets.forEach(function(obj){
			obj.draw && obj.draw();
			obj.active && obj.run && obj.run();
		});
	};
};

var Cloud = function(){
	this.x = 170;
	this.y = 80;
	this.fill = '#8ed6ff';
	this.destroy = false;
	this.active = true;

	this.activate = function(){
		this.active = true;
	};

	this.deactivate = function(){
		this.active = false;
	};

	this.destroy = function(){
		this.destroy = true;
	};

	this.draw = function(){
		fill(this.fill); // TODO
		ctx.fillStyle = this.fill;
		stroke(colors.blue);
		strokeWeight(5);
		engage();
		begin(this.x, this.y);
		bezierCurve(130, 100, 130, 150, 230, 150);
		bezierCurve(250, 180, 320, 180, 340, 150);
		bezierCurve(420, 150, 420, 120, 390, 100);
		bezierCurve(430, 40, 370, 30, 340, 50);
		bezierCurve(320, 5, 250, 20, 250, 50);
		bezierCurve(200, 5, 150, 20, 170, 80);
		paint();
	};
};

var GameBackground = function(){
	this.destroy = true;
	this.active = true;

	this.activate = function(){
		this.active = true;
	};

	this.deactivate = function(){
		this.active = false;
	};

	this.destroy = function(){
		this.destroy = true;
	};

	this.draw = function(){
		ctx.globalAlpha = 0.4;
		var linGrad = ctx.createLinearGradient(0, 0, 0, gameSize.height);
		linGrad.addColorStop(0, colors.brightskyblue);
		linGrad.addColorStop(0.85, colors.skyblue);
		linGrad.addColorStop(0.85, colors.greengrass);
		linGrad.addColorStop(1, colors.darkgreen);
		// TODO: fill(linGrad);
		c.fillStyle = ctx.fillStyle = linGrad;
		noStroke();
		rect(0, 0, gameSize.width, gameSize.height);
	};
};

var PausedScreen = function(){
	this.destroy = false;
	this.active = true;

	this.activate = function(){
		this.active = true;
	};

	this.deactivate = function(){
		this.active = false;
	};

	this.destroy = function(){
		this.destroy = true;
	};

	this.draw = function(){
		if (isPaused) {
			c.fillStyle = ctx.fillStyle = colors.black;
			noStroke();
			rect(0, 0, gameSize.width, gameSize.height);
		}
	};
};

var setup = function(){
	if (doFullScreen) {
		fullScreen();
	} else {
		size(gameSize.width, gameSize.height);
	}

	bg = new GameBackground();
	cloud = new Cloud();
	player = new Player(gameSize.width / 2, gameSize.height * 0.85);
	enemy = new Enemy();

	gameObjects.push(bg);
	gameObjects.push(cloud);
	gameObjects.push(player);
	gameObjects.push(enemy);
	gameObjects.push(new PausedScreen());
};

var draw = function(){
	loopGameObjects(function(obj){
		obj.draw && obj.draw();
		obj.active && obj.run && obj.run();
	});
	checkGameObjects();
};

var keyPressed = function(){
	playPause();
};

function playPause(){
	if (isPaused) {
		loopGameObjects(function(obj){
			obj.activate && obj.activate();
		});
	} else {
		loopGameObjects(function(obj){
			obj.deactivate && obj.deactivate();
		});
	}

	isPaused = !isPaused;
}

function containsPoint(obj1, obj2){
	if (obj1.x >= obj2.x &&
		obj1.y >= obj2.y &&
		obj1.x <= obj2.x + obj2.width &&
		obj1.y <= obj2.y + obj2.height) {
		return true;
	}
	return false;
}

function checkGameObjects(){
	loopGameObjects(function(obj, i){
		if (obj.destroy === true) {
			gameObjects = gameObjects.splice(i, 1);
		}
	});
}

function loopGameObjects(callback){
	for (var i = 0, il = gameObjects.length; i < il; i++) {
		callback(gameObjects[i], i);
	}
}

window.onload = function(){
	window.canvas = new Canvas(document.getElementById("canvas1"));
	window.ctx = canvas.ctx;
	canvas.setup = window.setup;
	canvas.draw = window.draw;
	canvas.run();
};

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42786295-1', 'hnswave.co');
ga('send', 'pageview');
</script>
</body>
</html>
